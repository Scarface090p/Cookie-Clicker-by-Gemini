<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Ultimate Cookie Clicker Clone</title>
    <style>
        :root { --panel-bg: #1a1a1a; --border-color: #5d4037; --gold: #e1b12c; --dark-gold: #b8860b; }
        body { margin: 0; padding: 0; background-color: #000; color: white; font-family: "Trebuchet MS", sans-serif; display: flex; height: 100vh; overflow: hidden; user-select: none; }

        /* Layout */
        #left-panel { flex: 1; background: linear-gradient(to bottom, #2980b9, #6dd5fa, #ffffff); display: flex; flex-direction: column; align-items: center; border-right: 4px solid var(--border-color); position: relative; }
        #center-panel { flex: 1.5; background-color: #000; border-right: 4px solid var(--border-color); display: flex; flex-direction: column; }
        #right-panel { width: 320px; background-color: #333; overflow-y: auto; }

        /* Stats & Cookie */
        #stats-bar { background: rgba(0,0,0,0.6); width: 100%; text-align: center; padding: 15px 0; border-bottom: 2px solid var(--border-color); z-index: 10; }
        #cookie-count { font-size: 32px; font-weight: bold; text-shadow: 2px 2px 4px #000; }
        #cps-count { font-size: 18px; color: #ccc; }
        #cookie { font-size: 180px; cursor: pointer; transition: transform 0.05s; filter: drop-shadow(0 0 30px rgba(0,0,0,0.5)); margin-top: 50px; }
        #cookie:active { transform: scale(0.90); }

        /* General Sections */
        .section-header { background: #444; padding: 10px; text-align: center; font-weight: bold; color: var(--gold); border-bottom: 2px solid var(--border-color); }

        /* Building & Upgrade Rows */
        .upgrade-row { display: flex; padding: 12px; border-bottom: 1px solid #222; cursor: pointer; background: #4a4a4a; transition: 0.1s; }
        .upgrade-row:hover:not(.disabled) { background: #5a5a5a; }
        .upgrade-row.disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
        .icon { width: 50px; height: 50px; background: #222; display: flex; align-items: center; justify-content: center; font-size: 28px; margin-right: 12px; border-radius: 4px; border: 2px solid #555; }
        .info { flex-grow: 1; }
        .name { font-weight: bold; display: block; }
        .cost { color: #66ff66; font-weight: bold; }
        .count { float: right; font-size: 24px; opacity: 0.2; }

        /* Tech Upgrades Bar (Center Panel) */
        #tech-bar { display: flex; flex-wrap: wrap; gap: 5px; padding: 10px; background: #222; min-height: 60px; border-bottom: 2px solid var(--border-color); }
        .tech-icon { width: 45px; height: 45px; background: #444; border: 2px solid var(--gold); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; position: relative; }
        .tech-icon:hover .tooltip { display: block; }
        .tooltip { display: none; position: absolute; top: 50px; left: 50%; transform: translateX(-50%); background: black; padding: 10px; width: 180px; z-index: 100; border: 1px solid white; font-size: 12px; text-align: left; }

        /* Achievements Display (Center Panel) */
        #achievements-display { flex-grow: 1; padding: 15px; overflow-y: auto; background-color: #111; }
        .achievement { display: flex; gap: 10px; margin-bottom: 10px; opacity: 0.4; transition: opacity 0.5s; }
        .achievement.unlocked { opacity: 1; }
        .achievement .ach-icon { font-size: 30px; }
        .achievement .ach-info .ach-name { font-weight: bold; color: var(--gold); }
        .achievement .ach-info .ach-desc { font-size: 12px; color: #ccc; }

        /* Save/Reset Buttons */
        .save-container { margin-top: auto; padding: 20px; background:#111; display:flex; gap:10px; justify-content: center; }
        button { background: #444; color: white; border: 1px solid #666; padding: 5px 15px; cursor: pointer; font-size: 12px; }
        button:hover { background: #555; }

        /* Golden Cookie */
        #golden-cookie { position: absolute; font-size: 60px; cursor: pointer; z-index: 1000; display: none; animation: spin 10s linear infinite; filter: drop-shadow(0 0 20px gold); }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Floating Text (Click effects) */
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-120px); opacity: 0; } }
        .floating-text { position: fixed; pointer-events: none; font-weight: bold; font-size: 24px; color: white; text-shadow: 1px 1px 2px black; animation: floatUp 0.8s ease-out forwards; z-index: 100; }

        /* Achievement Popup */
        #achievement-popup { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #1a1a1a; border: 2px solid var(--gold); padding: 15px; border-radius: 8px; z-index: 10000; display: none; animation: slideInUp 0.5s ease-out, fadeOut 3s ease-in 2s forwards; }
        #achievement-popup .ach-icon { font-size: 40px; float: left; margin-right: 10px; }
        #achievement-popup .ach-name { font-weight: bold; color: var(--gold); font-size: 18px; }
        #achievement-popup .ach-desc { font-size: 14px; color: #ccc; }

        @keyframes slideInUp { from { transform: translate(-50%, 100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

    </style>
</head>
<body>

    <div id="left-panel">
        <div id="stats-bar">
            <div id="cookie-count">0 cookies</div>
            <div id="cps-count">per second: 0</div>
        </div>
        <div id="cookie">üç™</div>
        <div id="golden-cookie">‚ú®üç™‚ú®</div>
    </div>

    <div id="center-panel">
        <div class="section-header">Upgrades</div>
        <div id="tech-bar"></div>
        <div class="section-header" style="border-top: 2px solid var(--border-color); margin-top: 10px;">Achievements</div>
        <div id="achievements-display"></div>
        <div id="news-ticker" style="padding:15px; font-style:italic; text-align:center; color:#ccc; border-top: 2px solid var(--border-color);">"Baked with love."</div>
        <div class="save-container">
            <button onclick="saveGame()">Save</button>
            <button onclick="deleteSave()">Hard Reset</button>
        </div>
    </div>

    <div id="right-panel">
        <div class="section-header">Store</div>
        <div id="buildings-list"></div>
    </div>

    <div id="achievement-popup">
        <span class="ach-icon"></span>
        <span class="ach-name"></span><br>
        <span class="ach-desc"></span>
    </div>

    <script>
        // --- GAME STATE ---
        let state = {
            cookies: 0,
            clickValue: 1,
            totalClicks: 0,
            totalCookiesBaked: 0,
            upgradesOwned: [],
            achievementsUnlocked: [],
            buildings: {
                cursor:  { name: "Cursor",  cost: 15,    cps: 0.1, count: 0, icon: "üñ±Ô∏è" },
                grandma: { name: "Grandma", cost: 100,   cps: 1,   count: 0, icon: "üëµ" },
                farm:    { name: "Farm",    cost: 1100,  cps: 8,   count: 0, icon: "üöú" },
                mine:    { name: "Mine",    cost: 12000, cps: 47,  count: 0, icon: "‚õèÔ∏è" },
                factory: { name: "Factory", cost: 130000, cps: 260, count: 0, icon: "üè≠" }
            }
        };

        const techUpgrades = [
            { id: 't1', name: 'Reinforced Index Finger', desc: 'Clicking is twice as efficient.', cost: 100, type: 'click', mult: 2, icon: '‚òùÔ∏è', req: () => state.totalClicks >= 10 },
            { id: 't2', name: 'Forwards from Grandma', desc: 'Grandmas are twice as efficient.', cost: 500, type: 'grandma', mult: 2, icon: '‚úâÔ∏è', req: () => state.buildings.grandma.count >= 1 },
            { id: 't3', name: 'Steel-plated Mouse', desc: 'Clicking is twice as efficient.', cost: 1000, type: 'click', mult: 2, icon: 'üñ±Ô∏è', req: () => state.totalClicks >= 100 },
            { id: 't4', name: 'Fertilizer', desc: 'Farms are twice as efficient.', cost: 5000, type: 'farm', mult: 2, icon: 'üå±', req: () => state.buildings.farm.count >= 1 },
            { id: 't5', name: 'Cookie Golem', desc: 'Mines are twice as efficient.', cost: 15000, type: 'mine', mult: 2, icon: 'ü™®', req: () => state.buildings.mine.count >= 1 },
            { id: 't6', name: 'Automation Software', desc: 'Factories are twice as efficient.', cost: 100000, type: 'factory', mult: 2, icon: '‚öôÔ∏è', req: () => state.buildings.factory.count >= 1 }
        ];

        const achievements = [
            { id: 'a1', name: 'Wake and Bake', desc: 'Bake 1,000 cookies.', icon: 'üç™', check: () => state.totalCookiesBaked >= 1000 },
            { id: 'a2', name: 'Cookie Novice', desc: 'Bake 10,000 cookies.', icon: 'üç™', check: () => state.totalCookiesBaked >= 10000 },
            { id: 'a3', name: 'Click Frenzy', desc: 'Click the big cookie 100 times.', icon: 'üñ±Ô∏è', check: () => state.totalClicks >= 100 },
            { id: 'a4', name: 'Grandma Power', desc: 'Own 10 grandmas.', icon: 'üëµ', check: () => state.buildings.grandma.count >= 10 },
            { id: 'a5', name: 'Farmville', desc: 'Own 10 farms.', icon: 'üöú', check: () => state.buildings.farm.count >= 10 },
            { id: 'a6', name: 'Golden Touch', desc: 'Click a golden cookie.', icon: '‚ú®', check: () => state.totalGoldenCookiesClicked >= 1 },
            { id: 'a7', name: 'Cookie Billionaire', desc: 'Bake 1,000,000,000 cookies.', icon: 'üí∞', check: () => state.totalCookiesBaked >= 1000000000 },
            { id: 'a8', name: 'Cookie Millionaire', desc: 'Bake 1,000,000 cookies.', icon: 'üí∏', check: () => state.totalCookiesBaked >= 1000000 },
        ];
        
        // Add default for golden cookies clicked if not present in save
        if (state.totalGoldenCookiesClicked === undefined) {
             state.totalGoldenCookiesClicked = 0;
        }

        // --- DOM Elements ---
        const cookieEl = document.getElementById('cookie');
        const achievementPopup = document.getElementById('achievement-popup');

        // --- CORE GAME FUNCTIONS ---
        function calculateCPS() {
            let total = 0;
            for (let b in state.buildings) {
                let building = state.buildings[b];
                let multiplier = 1;
                state.upgradesOwned.forEach(upId => {
                    let up = techUpgrades.find(t => t.id === upId);
                    if (up && up.type === b) multiplier *= up.mult;
                });
                total += (building.count * building.cps * multiplier);
            }
            return total;
        }

        function updateUI() {
            const currentCPS = calculateCPS();
            document.getElementById('cookie-count').innerText = Math.floor(state.cookies).toLocaleString() + " cookies";
            document.getElementById('cps-count').innerText = "per second: " + currentCPS.toFixed(1);

            // Update Buildings
            let bHtml = '';
            for (let id in state.buildings) {
                let b = state.buildings[id];
                bHtml += `<div class="upgrade-row ${state.cookies < b.cost ? 'disabled' : ''}" onclick="buyBuilding('${id}')">
                    <div class="icon">${b.icon}</div>
                    <div class="info"><span class="name">${b.name}</span><span class="cost">${Math.ceil(b.cost).toLocaleString()}</span></div>
                    <div class="count">${b.count}</div>
                </div>`;
            }
            document.getElementById('buildings-list').innerHTML = bHtml;

            // Update Tech Upgrades
            let tHtml = '';
            techUpgrades.forEach(up => {
                if (!state.upgradesOwned.includes(up.id) && up.req() && state.cookies >= (up.cost * 0.5)) { // Show if affordable
                    tHtml += `<div class="tech-icon ${state.cookies < up.cost ? 'disabled' : ''}" onclick="buyTech('${up.id}')">
                        ${up.icon}
                        <div class="tooltip"><b>${up.name}</b><br>${up.desc}<br>Cost: ${up.cost.toLocaleString()}</div>
                    </div>`;
                }
            });
            document.getElementById('tech-bar').innerHTML = tHtml;

            // Update Achievements Display
            let achHtml = '';
            achievements.forEach(ach => {
                const unlockedClass = state.achievementsUnlocked.includes(ach.id) ? 'unlocked' : '';
                achHtml += `<div class="achievement ${unlockedClass}">
                    <span class="ach-icon">${ach.icon}</span>
                    <div class="ach-info">
                        <span class="ach-name">${ach.name}</span><br>
                        <span class="ach-desc">${ach.desc}</span>
                    </div>
                </div>`;
            });
            document.getElementById('achievements-display').innerHTML = achHtml;
        }

        function buyBuilding(id) {
            let b = state.buildings[id];
            if (state.cookies >= b.cost) {
                state.cookies -= b.cost;
                b.count++;
                b.cost = Math.ceil(b.cost * 1.15); // Increase price by 15%
                updateUI();
                saveGame();
                checkAchievements();
            }
        }

        function buyTech(id) {
            let up = techUpgrades.find(t => t.id === id);
            if (state.cookies >= up.cost && !state.upgradesOwned.includes(id) && up.req()) {
                state.cookies -= up.cost;
                state.upgradesOwned.push(id);
                if (up.type === 'click') state.clickValue *= up.mult;
                updateUI();
                saveGame();
                checkAchievements();
            }
        }

        // --- GAME INTERACTION ---
        cookieEl.onclick = (e) => {
            state.cookies += state.clickValue;
            state.totalClicks++;
            state.totalCookiesBaked += state.clickValue;
            showFloatingText(`+${state.clickValue}`, e.clientX, e.clientY);
            updateUI();
            checkAchievements();
        };

        // Floating Text Animation
        function showFloatingText(txt, x, y, color = "white") {
            const div = document.createElement('div');
            div.className = 'floating-text';
            div.innerText = txt;
            div.style.left = x + 'px'; div.style.top = y + 'px';
            div.style.color = color;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 800);
        }

        // --- GOLDEN COOKIE ---
        function spawnGoldenCookie() {
            const gc = document.getElementById('golden-cookie');
            gc.style.top = Math.random() * 80 + "%";
            gc.style.left = Math.random() * 80 + "%";
            gc.style.display = "block";
            setTimeout(() => { gc.style.display = "none"; }, 10000); // Disappear after 10 seconds
        }

        document.getElementById('golden-cookie').onclick = function(event) {
            const bonus = Math.max(100, calculateCPS() * 600); // 10 minutes of CPS or 100 cookies
            state.cookies += bonus;
            state.totalCookiesBaked += bonus;
            state.totalGoldenCookiesClicked = (state.totalGoldenCookiesClicked || 0) + 1; // Increment golden cookie count
            this.style.display = "none";
            showFloatingText(`+${Math.floor(bonus).toLocaleString()}!`, event.clientX, event.clientY, "gold");
            updateUI();
            saveGame();
            checkAchievements();
        };

        // --- ACHIEVEMENTS ---
        function checkAchievements() {
            achievements.forEach(ach => {
                if (!state.achievementsUnlocked.includes(ach.id) && ach.check()) {
                    state.achievementsUnlocked.push(ach.id);
                    showAchievementPopup(ach);
                }
            });
            updateUI(); // To update the achievement display
        }

        let achievementPopupTimeout;
        function showAchievementPopup(ach) {
            clearTimeout(achievementPopupTimeout); // Clear any existing popup
            achievementPopup.querySelector('.ach-icon').innerText = ach.icon;
            achievementPopup.querySelector('.ach-name').innerText = ach.name;
            achievementPopup.querySelector('.ach-desc').innerText = ach.desc;
            achievementPopup.style.display = 'block';
            achievementPopupTimeout = setTimeout(() => {
                achievementPopup.style.display = 'none';
            }, 5000); // Popup visible for 5 seconds
        }

        // --- SAVE/LOAD ---
        function saveGame() {
            localStorage.setItem('cookieSaveV3', JSON.stringify(state));
            document.getElementById('news-ticker').innerText = '"Game saved!"';
            setTimeout(() => document.getElementById('news-ticker').innerText = '"' + news[Math.floor(Math.random()*news.length)] + '"', 2000);
        }

        function loadGame() {
            const saved = localStorage.getItem('cookieSaveV3');
            if (saved) {
                const loadedState = JSON.parse(saved);
                // Merge loaded state with default to handle new features gracefully
                state = {...state, ...loadedState};
                // Ensure default values for new properties in old saves
                if (state.totalCookiesBaked === undefined) state.totalCookiesBaked = 0;
                if (state.totalClicks === undefined) state.totalClicks = 0;
                if (state.totalGoldenCookiesClicked === undefined) state.totalGoldenCookiesClicked = 0;
                if (state.upgradesOwned === undefined) state.upgradesOwned = [];
                if (state.achievementsUnlocked === undefined) state.achievementsUnlocked = [];

                // Re-calculate click value based on owned upgrades
                state.clickValue = 1;
                state.upgradesOwned.forEach(id => {
                    let up = techUpgrades.find(t => t.id === id);
                    if (up && up.type === 'click') state.clickValue *= up.mult;
                });
            }
            updateUI();
            checkAchievements(); // Check for any achievements that might have been met by loaded data
        }

        function deleteSave() {
            if (confirm("Are you sure you want to reset all your progress? This cannot be undone!")) {
                localStorage.removeItem('cookieSaveV3');
                location.reload(); // Reloads the page, effectively starting a new game
            }
        }

        // --- GAME LOOPS & NEWS ---
        setInterval(() => { state.cookies += (calculateCPS() / 10); state.totalCookiesBaked += (calculateCPS() / 10); updateUI(); checkAchievements(); }, 100);
        setInterval(saveGame, 30000); // Autosave every 30 seconds

        setInterval(() => { if (Math.random() < 0.2) spawnGoldenCookie(); }, 45000); // 20% chance every 45 seconds

        const news = [
            "News: Cookies are officially better than sleep.",
            "News: A grandma says she loves you.",
            "News: Cookie mines found on Mars!",
            "News: World debt settled with chocolate chips.",
            "News: Local baker becomes cookie tycoon.",
            "News: Scientists discover cookies cure everything."
        ];
        let newsIndex = 0;
        setInterval(() => {
            document.getElementById('news-ticker').innerText = '"' + news[newsIndex] + '"';
            newsIndex = (newsIndex + 1) % news.length;
        }, 8000); // Change news every 8 seconds

        // --- INITIALIZATION ---
        loadGame();
    </script>
</body>
</html>
