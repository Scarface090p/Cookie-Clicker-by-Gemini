<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie Clicker: Ultimate Combined Edition</title>
    <style>
        :root {
            --border: #5d4037;
            --gold: #e1b12c;
            --bg-dark: #000000;
            --panel-overlay: rgba(0, 0, 0, 0.75);
        }

        body {
            margin: 0;
            background: radial-gradient(circle, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white;
            font-family: "Trebuchet MS", sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- LAYOUT PANELS --- */
        #left-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-right: 4px solid var(--border);
            position: relative;
            background: rgba(0,0,0,0.2);
        }

        #center-panel {
            flex: 1.5;
            background: var(--panel-overlay);
            border-right: 4px solid var(--border);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        #right-panel {
            width: 380px;
            background: #2c1e1a;
            overflow-y: auto;
            position: relative;
            z-index: 10;
        }

        /* --- LEFT PANEL: COOKIE & MILK --- */
        #stats-container {
            background: rgba(0,0,0,0.8);
            width: 100%;
            text-align: center;
            padding: 25px 0;
            border-bottom: 3px solid var(--border);
            z-index: 5;
        }

        #cookie-count { font-size: 36px; font-weight: bold; text-shadow: 2px 2px #000; }
        #cps-display { font-size: 18px; color: #ccc; margin-top: 5px; }

        #cookie-wrapper {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        #main-cookie {
            font-size: 200px;
            cursor: pointer;
            transition: transform 0.05s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 50px rgba(0,0,0,0.5));
            z-index: 2;
        }
        #main-cookie:active { transform: scale(0.9); }

        #milk {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 0%;
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 -10px 50px rgba(255,255,255,0.5);
            transition: height 1s ease;
            z-index: 1;
        }

        /* --- CENTER PANEL: UPGRADES & ACHIEVEMENTS --- */
        .section-header {
            background: #444;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: var(--gold);
            border-bottom: 2px solid var(--border);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #upgrade-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 12px;
            background: #111;
            min-height: 60px;
            max-height: 200px;
            overflow-y: auto;
            border-bottom: 4px solid var(--border);
        }

        .upgrade-icon {
            width: 48px;
            height: 48px;
            background: #333;
            border: 2px solid var(--gold);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: 0.2s;
        }
        .upgrade-icon:hover { background: #555; transform: scale(1.1); }
        .upgrade-icon.disabled { filter: grayscale(1); opacity: 0.3; cursor: not-allowed; }

        #achievement-list {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            background: #050505;
        }

        .ach-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            margin-bottom: 8px;
            background: #1a1a1a;
            border-left: 4px solid #333;
            opacity: 0.2;
            transition: 0.5s;
        }
        .ach-card.unlocked { opacity: 1; border-left-color: var(--gold); background: #222; }

        #news-ticker {
            background: #000;
            padding: 12px;
            text-align: center;
            font-style: italic;
            color: #aaa;
            border-top: 2px solid var(--border);
        }

        /* --- RIGHT PANEL: STORE --- */
        #buy-amount-toggle {
            display: flex;
            background: #111;
            padding: 8px;
            justify-content: center;
            gap: 10px;
            border-bottom: 2px solid var(--border);
        }

        .toggle-btn {
            background: #333;
            border: 1px solid #555;
            color: #eee;
            padding: 6px 16px;
            cursor: pointer;
            font-weight: bold;
        }
        .toggle-btn.active { background: var(--gold); color: black; border-color: white; }

        .store-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #222;
            background: #3d2b26;
            cursor: pointer;
            transition: background 0.1s;
        }
        .store-item:hover:not(.disabled) { background: #523a33; }
        .store-item.disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(0.5); }

        .item-icon {
            width: 60px;
            height: 60px;
            background: #1a1a1a;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin-right: 15px;
            border: 2px solid #555;
        }

        .item-meta { flex-grow: 1; }
        .item-name { font-weight: bold; font-size: 20px; display: block; }
        .item-cost { color: #66ff66; font-weight: bold; font-size: 16px; }
        .item-qty { font-size: 32px; opacity: 0.15; font-weight: bold; margin-left: 10px; }

        /* --- PARTICLES & BONUSES --- */
        .click-particle {
            position: fixed;
            pointer-events: none;
            font-weight: bold;
            font-size: 28px;
            color: white;
            text-shadow: 2px 2px black;
            animation: particleFloat 0.8s forwards;
            z-index: 1000;
        }

        @keyframes particleFloat {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-150px); opacity: 0; }
        }

        #golden-cookie {
            position: absolute;
            font-size: 80px;
            cursor: pointer;
            z-index: 2000;
            display: none;
            filter: drop-shadow(0 0 30px gold);
            animation: rotateGold 10s linear infinite;
        }

        @keyframes rotateGold { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .system-controls {
            padding: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            background: #000;
        }
        .sys-btn { background: #444; color: white; border: none; padding: 8px 20px; cursor: pointer; }
        .sys-btn:hover { background: #666; }

    </style>
</head>
<body>

    <div id="left-panel">
        <div id="stats-container">
            <div id="cookie-count">0 cookies</div>
            <div id="cps-display">per second: 0.0</div>
        </div>
        <div id="cookie-wrapper">
            <div id="main-cookie">üç™</div>
        </div>
        <div id="golden-cookie">‚ú®üç™‚ú®</div>
        <div id="milk"></div>
    </div>

    <div id="center-panel">
        <div class="section-header">Upgrades</div>
        <div id="upgrade-grid"></div>

        <div class="section-header">Achievements</div>
        <div id="achievement-list"></div>

        <div id="news-ticker">"Welcome to your cookie bakery!"</div>

        <div class="system-controls">
            <button class="sys-btn" onclick="Game.save()">Manual Save</button>
            <button class="sys-btn" onclick="Game.hardReset()">Hard Reset</button>
        </div>
    </div>

    <div id="right-panel">
        <div class="section-header">Store</div>
        <div id="buy-amount-toggle">
            <button id="buy1" class="toggle-btn active" onclick="Game.setBuyMode(1)">1x</button>
            <button id="buy10" class="toggle-btn" onclick="Game.setBuyMode(10)">10x</button>
            <button id="buy100" class="toggle-btn" onclick="Game.setBuyMode(100)">100x</button>
        </div>
        <div id="store-list"></div>
    </div>

    <script>
        const Game = {
            cookies: 0,
            bakedTotal: 0,
            clicksTotal: 0,
            clickValue: 1,
            buyMode: 1,
            ownedUpgrades: [],
            unlockedAch: [],
            
            buildings: {
                cursor:  { name: "Cursor",   baseCost: 15,     cps: 0.1, count: 0, icon: "üñ±Ô∏è" },
                grandma: { name: "Grandma",  baseCost: 100,    cps: 1,   count: 0, icon: "üëµ" },
                farm:    { name: "Farm",     baseCost: 1100,   cps: 8,   count: 0, icon: "üöú" },
                mine:    { name: "Mine",     baseCost: 12000,  cps: 47,  count: 0, icon: "‚õèÔ∏è" },
                factory: { name: "Factory",  baseCost: 130000, cps: 260, count: 0, icon: "üè≠" },
                bank:    { name: "Bank",     baseCost: 1400000,cps: 1400,count: 0, icon: "üè¶" },
                temple:  { name: "Temple",   baseCost: 20000000,cps: 7800,count: 0,icon: "üïç" },
                wizard:  { name: "Wizard",   baseCost: 330000000,cps: 44000,count: 0,icon: "üßô" },
                ship:    { name: "Ship",     baseCost: 5100000000,cps: 260000,count:0,icon: "üöÄ" },
                alch:    { name: "Alchemy",  baseCost: 75000000000,cps: 1600000,count:0,icon: "‚öóÔ∏è" },
                portal:  { name: "Portal",   baseCost: 1000000000000,cps: 10000000,count:0,icon: "üåÄ" },
                time:    { name: "Time",     baseCost: 14000000000000,cps: 65000000,count:0,icon: "‚è≥" }
            },

            upgrades: [],
            achievements: [
                { id: 'a1', n: 'Wake & Bake', d: 'Bake 1,000 cookies.', check: () => Game.bakedTotal >= 1000, i: 'üç™' },
                { id: 'a2', n: 'Click Freak', d: 'Click 100 times.', check: () => Game.clicksTotal >= 100, i: 'üñ±Ô∏è' },
                { id: 'a3', n: 'Millionaire', d: 'Bake 1,000,000 cookies.', check: () => Game.bakedTotal >= 1000000, i: 'üíé' },
                { id: 'a4', n: 'Elderly Home', d: 'Own 50 Grandmas.', check: () => Game.buildings.grandma.count >= 50, i: 'üëµ' },
                { id: 'a5', n: 'Interdimensional', d: 'Bake 1,000,000,000 cookies.', check: () => Game.bakedTotal >= 1000000000, i: 'üåå' }
            ],

            init() {
                // Generate 100 Click Upgrades
                for(let i=1; i<=100; i++) {
                    this.upgrades.push({
                        id: `finger_${i}`,
                        n: `Finger Upgrade #${i}`,
                        cost: Math.floor(100 * Math.pow(2.2, i)),
                        type: 'click',
                        mult: 2,
                        i: '‚òùÔ∏è',
                        req: () => Game.clicksTotal >= (i * 10)
                    });
                }
                
                this.load();
                this.setupEventListeners();
                this.gameLoop();
                this.refreshUI();
            },

            setupEventListeners() {
                document.getElementById('main-cookie').onclick = (e) => {
                    this.cookies += this.clickValue;
                    this.bakedTotal += this.clickValue;
                    this.clicksTotal++;
                    this.createParticle(e.clientX, e.clientY, `+${this.clickValue}`);
                    this.refreshUI();
                };

                document.getElementById('golden-cookie').onclick = (e) => {
                    const bonus = Math.max(100, this.calculateCPS() * 900);
                    this.cookies += bonus;
                    this.bakedTotal += bonus;
                    e.target.style.display = 'none';
                    this.createParticle(e.clientX, e.clientY, `+${Math.floor(bonus).toLocaleString()}`, "gold");
                };
            },

            calculateCPS() {
                let total = 0;
                for (let k in this.buildings) {
                    total += (this.buildings[k].count * this.buildings[k].cps);
                }
                return total;
            },

            getBulkCost(base, count, amt) {
                let total = 0;
                let current = base * Math.pow(1.15, count);
                for(let i=0; i<amt; i++) {
                    total += current;
                    current *= 1.15;
                }
                return Math.ceil(total);
            },

            buyBuilding(id) {
                const b = this.buildings[id];
                const cost = this.getBulkCost(b.baseCost, b.count, this.buyMode);
                if (this.cookies >= cost) {
                    this.cookies -= cost;
                    b.count += this.buyMode;
                    this.refreshUI();
                }
            },

            buyUpgrade(id) {
                const u = this.upgrades.find(x => x.id === id);
                if (this.cookies >= u.cost) {
                    this.cookies -= u.cost;
                    this.ownedUpgrades.push(id);
                    if (u.type === 'click') this.clickValue *= u.mult;
                    this.refreshUI();
                }
            },

            setBuyMode(amt) {
                this.buyMode = amt;
                document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('buy' + amt).classList.add('active');
                this.refreshUI();
            },

            createParticle(x, y, text, color="white") {
                const p = document.createElement('div');
                p.className = 'click-particle';
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                p.style.color = color;
                p.innerText = text;
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);
            },

            refreshUI() {
                document.getElementById('cookie-count').innerText = Math.floor(this.cookies).toLocaleString() + " cookies";
                document.getElementById('cps-display').innerText = "per second: " + this.calculateCPS().toFixed(1);
                
                // Milk height based on total baked
                document.getElementById('milk').style.height = Math.min(70, (this.bakedTotal / 2000)) + "%";

                // Update Store
                let sHtml = '';
                for (let k in this.buildings) {
                    const b = this.buildings[k];
                    const cost = this.getBulkCost(b.baseCost, b.count, this.buyMode);
                    sHtml += `
                        <div class="store-item ${this.cookies < cost ? 'disabled' : ''}" onclick="Game.buyBuilding('${k}')">
                            <div class="item-icon">${b.icon}</div>
                            <div class="item-meta">
                                <span class="item-name">${b.name} (x${this.buyMode})</span>
                                <span class="item-cost">${cost.toLocaleString()}</span>
                            </div>
                            <div class="item-qty">${b.count}</div>
                        </div>`;
                }
                document.getElementById('store-list').innerHTML = sHtml;

                // Update Upgrades
                let uHtml = '';
                this.upgrades.forEach(u => {
                    if (!this.ownedUpgrades.includes(u.id) && u.req()) {
                        uHtml += `
                            <div class="upgrade-icon ${this.cookies < u.cost ? 'disabled' : ''}" 
                                 onclick="Game.buyUpgrade('${u.id}')" title="${u.n} (Cost: ${u.cost.toLocaleString()})">
                                 ${u.i}
                            </div>`;
                    }
                });
                document.getElementById('upgrade-grid').innerHTML = uHtml;

                // Update Achievements
                let aHtml = '';
                this.achievements.forEach(a => {
                    if (a.check() && !this.unlockedAch.includes(a.id)) {
                        this.unlockedAch.push(a.id);
                    }
                    const isU = this.unlockedAch.includes(a.id);
                    aHtml += `
                        <div class="ach-card ${isU ? 'unlocked' : ''}">
                            <div class="ach-icon" style="font-size:30px">${isU ? a.i : '‚ùì'}</div>
                            <div>
                                <div class="ach-name">${isU ? a.n : 'Locked Achievement'}</div>
                                <div class="ach-desc">${isU ? a.d : 'Keep baking to find out...'}</div>
                            </div>
                        </div>`;
                });
                document.getElementById('achievement-list').innerHTML = aHtml;
            },

            gameLoop() {
                setInterval(() => {
                    const gain = this.calculateCPS() / 10;
                    this.cookies += gain;
                    this.bakedTotal += gain;
                    this.refreshUI();
                }, 100);

                // Golden Cookie Logic
                setInterval(() => {
                    if (Math.random() < 0.3) {
                        const gc = document.getElementById('golden-cookie');
                        gc.style.left = Math.random() * 80 + "%";
                        gc.style.top = Math.random() * 80 + "%";
                        gc.style.display = "block";
                        setTimeout(() => gc.style.display = 'none', 10000);
                    }
                }, 60000);

                // News Ticker
                const news = ["Grandmas are plotting.", "Cookie planet discovered.", "Cookies found in deep space.", "Bakery opens to rave reviews."];
                setInterval(() => {
                    document.getElementById('news-ticker').innerText = '"' + news[Math.floor(Math.random()*news.length)] + '"';
                }, 10000);
            },

            save() {
                localStorage.setItem('cookie_master_save', JSON.stringify({
                    cookies: this.cookies,
                    bakedTotal: this.bakedTotal,
                    clicksTotal: this.clicksTotal,
                    clickValue: this.clickValue,
                    ownedUpgrades: this.ownedUpgrades,
                    unlockedAch: this.unlockedAch,
                    buildings: this.buildings
                }));
            },

            load() {
                const s = localStorage.getItem('cookie_master_save');
                if (s) {
                    const data = JSON.parse(s);
                    Object.assign(this, data);
                }
            },

            hardReset() {
                if (confirm("Wipe all data?")) {
                    localStorage.clear();
                    location.reload();
                }
            }
        };

        window.onload = () => Game.init();
    </script>
</body>
</html>
